function editable(t){var i=$(t).text();$(t).html('<input class="form-control" type="text" id="myInput">'),$("#myInput").val(i),$("#myInput").focus()}function update(){$("#monthly_main>tr").each(function(){var t=1;$(this).find(".numbers").each(function(){t*=parseInt($(this).text())}),$(this).find(".month-amount").empty(),$(this).find(".month-amount").html('<i class="fa fa-yen"></i>'+t.toString())}),calculate(".month-amount",".monthly-cost",".month-tax"),$("#install_main>tr").each(function(){var t=1;$(this).find(".numbers").each(function(){t*=parseInt($(this).text())}),$(this).find(".install-amount").empty(),$(this).find(".install-amount").html('<i class="fa fa-yen"></i>'+t.toString())}),calculate(".install-amount",".install-costs",".install-tax")}function delete_row(t){$(t).closest("tr").remove(),reorder(),update()}function add_note(t){var i=$(t).closest("tr").find(".note").val(),n=$(t).closest("tr");n.empty(),n.html("<td>"+i+"</td>")}function add_monthly(t){var i=$("#monthly_main").find("tr").length,n='<tr style="display: table-row;" class="ui-sortable-handle" id="row-'+i+'" role="row"><td class="item-number">'+(i+1)+'</td><td><input id="monthly_item" class="form-control" type="text" /></td><td><input id="monthly_qty" class="form-control" type="text" /></td><td><input id="monthly_unit" class="form-control" type="text" /></td><td><input id="monthly_price" class="form-control" type="text" /></td><td><input id="monthly_amount" class="form-control" type="text" disabled="disabled" /></td><td><input id="monthly_note" class="form-control" type="text" /></td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div><div class="form-group"><button onclick="save_monthly_row(this)" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i></button></div></div></td></tr>';$("#monthly_main").append(n)}function save_monthly_row(t){var i=/^\d+$/,n=$(t).closest("tr"),a=n.find(".item-number").html(),s=n.find("#monthly_item").val(),l=i.test(n.find("#monthly_qty").val())?n.find("#monthly_qty").val():0,e=n.find("#monthly_unit").val(),d=i.test(n.find("#monthly_price").val())?n.find("#monthly_price").val():0,o=n.find("#monthly_note").val();n.empty();var c='<td class="sorting">'+a+'</td><td onclick="editable(this)">'+s+'</td><td class="numbers" onclick="editable(this)">'+l+'</td><td  onclick="editable(this)">'+e+'</td><td class="numbers price"  onclick="editable(this)"><i class="fa fa-yen"></i> '+d+'</td><td class="month-amount"><i class="fa fa-yen"></i> '+l*d+'</td><td onclick="editable(this)">'+o+'</td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></td>';n.html(c),update()}function reorder(){$("#monthly_tbl").find(".item-number").each(function(t){$(this).empty(),$(this).html(t+1)})}function add_install(t){var i=$("#install_main").find("tr").length,n='<tr style="display: table-row;" class="ui-sortable-handle" id="row-'+i+'" role="row"><td class="item-number">'+(i+1)+'</td><td><input id="monthly_item" class="form-control" type="text" /></td><td><input id="monthly_qty" class="form-control" type="text" /></td><td><input id="monthly_unit" class="form-control" type="text" /></td><td><input id="monthly_price" class="form-control" type="text" /></td><td><input id="monthly_amount" class="form-control" type="text" disabled="disabled" /></td><td><input id="monthly_note" class="form-control" type="text" /></td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div><div class="form-group"><button onclick="save_install_row(this)" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i></button></div></div></td></tr>';$("#install_main").append(n)}function save_install_row(t){var i=/^\d+$/,n=$(t).closest("tr"),a=n.find(".item-number").html(),s=n.find("#monthly_item").val(),l=i.test(n.find("#monthly_qty").val())?n.find("#monthly_qty").val():0,e=n.find("#monthly_unit").val(),d=i.test(n.find("#monthly_price").val())?n.find("#monthly_price").val():0,o=n.find("#monthly_note").val();n.empty();var c='<td class="sorting">'+a+'</td><td onclick="editable(this)">'+s+'</td><td class="numbers" onclick="editable(this)">'+l+'</td><td  onclick="editable(this)">'+e+'</td><td class="numbers price" onclick="editable(this)"><i class="fa fa-yen"></i> '+d+'</td><td class="install-amount"><i class="fa fa-yen"></i> '+l*d+'</td><td onclick="editable(this)">'+o+'</td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></td>';n.html(c),update()}function calculate(t,i,n){var a=0;$(t).each(function(){a+=parseInt($(this).text())}),$(i).empty(),$(n).empty();var s=.08*a;$(n).html('<i class="fa fa-yen"></i> '+s.toString()),a+=s,$(i).html('<i class="fa fa-yen"></i> '+a.toString())}$.get("http://json.invite-comm.jp/api/json/monthly",function(t){if(t){for(var i,n="",a=0,s=0,l=0;l<t.length;l++)n+='<tr><td class="item-number">'+t[l].item+'</td><td onclick="editable(this)">'+t[l].desc+'</td><td class="numbers" onclick="editable(this)">'+t[l].qty+'</td><td  onclick="editable(this)">'+t[l].unit+'</td><td class="numbers price" onclick="editable(this)"><i class="fa fa-yen"></i> '+t[l].price+'</td><td class="month-amount"><i class="fa fa-yen"></i> '+t[l].amount+'</td><td onclick="editable(this)">'+t[l].comment+'</td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></td></tr>',a+=t[l].amount;s=a+(i=.08*a);var e='<tbody><tr><td>#</td><td>Consumption Tax</td><td>1</td><td>8%</td><td class="month-tax"><i class="fa fa-yen"></i> '+a+'</td><td class="month-tax"><i class="fa fa-yen"></i> '+i+'</td><td colspan="2"></td></tr>';e+='<tr><td colspan="4" class="text-center">Monthly Costs:</td><td class="text-center monthly-cost" colspan="4"></td></tr></tbody>',$("#monthly_tbl").find("tbody").append(n),$("#monthly_tbl").append(e),$(".monthly-cost").html('<i class="fa fa-yen"></i> '+s.toString()),$("#monthly_tbl").dataTable({searching:!1,bPaginate:!1,bLengthChange:!0,bFilter:!0,bInfo:!1,bAutoWidth:!1,createdRow:function(t,i,n){$(t).attr("id","row-"+n)}}),$("#monthly_tbl").rowReordering()}}),$.get("http://json.invite-comm.jp/api/json/notes",function(t){if(t){for(var i="",n=0;n<t.length;n++)i+="<tr><td>"+t[n].item+") "+t[n].text+"</td></tr>";$("#note_tbl").find("tbody").append(i),$("#note_tbl").dataTable({searching:!1,bPaginate:!1,bLengthChange:!1,bFilter:!0,bInfo:!1,bAutoWidth:!1,bSort:!1})}}),$.get("http://json.invite-comm.jp/api/json/company",function(t){if(t){var i="<h4>"+t.company+"</h4>";i+='<div class="form-inline"><div class="form-group inline-margin"><p><b>Service type:</b> '+t.type+'</p></div><div class="form-group inline-margin"><p><b>Delivery date:</b> '+t.delivery+'</p></div><div class="form-group inline-margin"><p><b>Payment terms:</b> '+t.terms+"</p></div></div>",$("#company").append(i)}}),$.get("http://json.invite-comm.jp/api/json/install",function(t){if(t){for(var i,n="",a=0,s=0,l=0;l<t.length;l++)n+="<tr><td>"+t[l].item+'</td><td onclick="editable(this)">'+t[l].desc+'</td><td class="numbers" onclick="editable(this)">'+t[l].qty+'</td><td onclick="editable(this)">'+t[l].unit+'</td><td class="numbers price" onclick="editable(this)"><i class="fa fa-yen"></i> '+t[l].price+'</td><td class="install-amount"><i class="fa fa-yen"></i> '+t[l].amount+'</td><td onclick="editable(this)">'+t[l].comment+'</td><td><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></td></tr>',a+=t[l].amount;s=a+(i=.08*a);var e='<tbody><tr id="row-'+t.length+'"><td>#</td><td>Consumption Tax</td><td>1</td><td>8%</td><td class="install-tax"><i class="fa fa-yen"></i> '+a+'</td><td class="install-tax"><i class="fa fa-yen"></i> '+i+'</td><td colspan="2"></td></tr>';e+='<tr id="row-'+(t.length+1)+'"><td colspan="3" class="text-center">Initial Costs:</td><td class="text-center install-costs" colspan="5"><i class="fa fa-yen"></i></td></tr></tbody>',$("#installation_tbl").find("tbody").append(n),$("#installation_tbl").append(e),$(".install-costs").html('<i class="fa fa-yen"></i> '+s.toString()),$("#installation_tbl").dataTable({searching:!1,bPaginate:!1,bLengthChange:!0,bFilter:!1,bInfo:!1,bAutoWidth:!1,createdRow:function(t,i,n){$(t).attr("id","row-"+n)}}),$("#installation_tbl").rowReordering()}}),$(document).ready(function(){$(document).delegate("#myInput","focusout",function(){var t=$(this).val(),i="";$(this).parent().hasClass("price")&&(i+='<i class="fa fa-yen"></i>'),i+=t,$(this).parent().html(i),update(),$(this).remove()}),$(document).delegate("#myInput","keypress",function(t){if(13==t.which){var i=$(this).val();$(this).parent().text(i),$(this).remove()}})}),$(".note-add").click(function(t){t.preventDefault();$("#note_tbl").find("tbody").prepend('<tr><td><div class="row"><div class="col-sm-10"><div class="form-group inline-margin"><input class="form-control note" type="text" /></div></div><div class="col-sm-2"><div class="form-inline"><div class="form-group"><button onclick="delete_row(this)" class="btn btn-alert"><i class="fa fa-trash" aria-hidden="true"></i></button></div><div class="form-group"><button onclick="add_note(this)" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i></button></div></div></td></tr>')});